{"version":3,"sources":["../../../../server/components/queue/queue.js"],"names":[],"mappings":";;AAAC,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC5B,IAAI,QAAQ,GAAG,OAAO,CAAC,SAAS,CAAC,CAAC;;AAElC,MAAM,CAAC,OAAO,GAAG,UAAS,MAAM,EAAC;;AAE7B,QAAI,IAAI,GAAG,EAAE;QAAG,OAAO,CAAC;AACxB,QAAI,IAAI,GAAG,IAAI,CAAC;;AAEhB,QAAI,IAAI,GAAG,CAAA,UAAS,GAAG,EAAC;AACpB,YAAI,CAAC,IAAI,GAAG,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,GAAG,EAAC,GAAG,CAAC,IAAI,EAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,CAAC;KAC5E,CAAA,CAAC,MAAM,CAAC,CAAC;;;AAGV,WAAO;AACH,eAAO,EAAC,iBAAS,KAAK,EAAE,OAAO,EAAC;AAC5B,gBAAI,CAAC,IAAI,CAAC,IAAI,CAAC,UAAS,IAAI,EAAC;AACzB,oBAAI,EAAE,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;AAC7D,kBAAE,GAAG,EAAE,CAAC,IAAI,CAAC,UAAS,EAAE,EAAE;AACtB,sBAAE,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;AACtB,sBAAE,CAAC,WAAW,CAAC,KAAK,EAAE,IAAI,MAAM,CAAC,OAAO,CAAC,CAAC,CAAC;iBAC9C,CAAC,CAAC;aACN,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC;SAC/B;AACD,eAAO,EAAC,iBAAS,KAAK,EAAC,OAAO,EAAC;AAC3B,gBAAI,CAAC,IAAI,CAAC,IAAI,CAAC,UAAS,IAAI,EAAC;AACzB,oBAAI,EAAE,GAAG,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,aAAa,EAAE,CAAC;AAC7D,kBAAE,GAAG,EAAE,CAAC,IAAI,CAAC,UAAS,EAAE,EAAE;AACtB,sBAAE,CAAC,WAAW,CAAC,KAAK,CAAC,CAAC;AACtB,sBAAE,CAAC,OAAO,CAAC,KAAK,EAAE,UAAS,GAAG,EAAC;AAC3B,4BAAG,GAAG,KAAG,IAAI,EAAC;AACV,mCAAO,CAAC,GAAG,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,CAAC;AAChC,8BAAE,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;yBACf;qBACJ,CAAC,CAAC;iBACN,CAAC,CAAC;aACN,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,CAAC,IAAI,CAAC,CAAC;SAC/B;KACJ,CAAA;CACJ,CAAA","file":"queue.js","sourcesContent":["ï»¿var util = require(\"util\");\r\nvar rabbitmq = require(\"amqplib\");\r\n\r\nmodule.exports = function(config){\r\n    //private\r\n    var amqp = {} , channel;\r\n    var that = this;\r\n    //constructor\r\n    var init = function(cfg){\r\n        that.amqp = rabbitmq.connect(util.format(cfg.url,cfg.user,cfg.password));\r\n    }(config);\r\n\r\n    //public\r\n    return {\r\n        enqueue:function(queue, message){\r\n            that.amqp.then(function(conn){\r\n                var ok = that.channel = that.channel || conn.createChannel();\r\n                ok = ok.then(function(ch) {\r\n                    ch.assertQueue(queue);\r\n                    ch.sendToQueue(queue, new Buffer(message));\r\n                });\r\n            }).then(null, console.warn);\r\n        },\r\n        consume:function(queue,process){\r\n            that.amqp.then(function(conn){\r\n                var ok = that.channel = that.channel || conn.createChannel();\r\n                ok = ok.then(function(ch) {\r\n                    ch.assertQueue(queue);\r\n                    ch.consume(queue, function(msg){\r\n                        if(msg!==null){\r\n                            process(msg.content.toString());\r\n                            ch.ack(msg);\r\n                        }\r\n                    });\r\n                });\r\n            }).then(null, console.warn);\r\n        }\r\n    }\r\n}"]}