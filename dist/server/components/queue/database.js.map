{"version":3,"sources":["../../../../server/components/queue/database.js"],"names":[],"mappings":";;AAAC,IAAI,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AAC5B,IAAI,KAAK,GAAG,OAAO,CAAC,WAAW,CAAC,CAAC;AACjC,IAAI,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC;;AAErB,MAAM,CAAC,OAAO,GAAG,UAAS,MAAM,EAAC;;AAE7B,QAAI,EAAE,GAAG,EAAE,CAAC;AACZ,QAAI,QAAQ,GAAG,EAAE,CAAC;AAClB,QAAI,OAAO,GAAG,EAAE,CAAC;AACjB,QAAI,IAAI,GAAG,IAAI,CAAC;;AAEhB,QAAI,IAAI,GAAG,CAAA,UAAU,GAAG,EAAC;AACrB,YAAI,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,uBAAuB,EAAE,GAAG,CAAC,QAAQ,EAAE,GAAG,CAAC,QAAQ,EAAE,GAAG,CAAC,GAAG,EAAE,GAAG,CAAC,QAAQ,CAAC,CAAC;AAClG,YAAI,CAAC,EAAE,GAAG,KAAK,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC;AACjD,YAAI,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;AAC3B,YAAI,CAAC,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;KAC7B,CAAA,CAAC,MAAM,CAAC,CAAC;;;AAGV,WAAO;AACH,kBAAU,EAAC,oBAAS,IAAI,EAAC;AACrB,gBAAI,QAAQ,GAAG,CAAC,CAAC,KAAK,EAAE,CAAC;AACzB,gBAAI,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO,CAAC,EAAC,IAAI,EAAC,IAAI,EAAC,EAAC,UAAS,GAAG,EAAC,GAAG,EAAC;AAC7C,oBAAG,GAAG,EAAE,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAC7B,wBAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;aACzB,CAAC,CAAC;AACP,mBAAO,QAAQ,CAAC,OAAO,CAAC;SAC3B;AACD,mBAAW,EAAC,qBAAS,IAAI,EAAC;AACtB,gBAAI,QAAQ,GAAG,CAAC,CAAC,KAAK,EAAE,CAAC;AACzB,gBAAI,CAAC,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAC,IAAI,EAAC,IAAI,EAAC,EAAC,UAAS,GAAG,EAAC,GAAG,EAAC;AAC9C,oBAAG,GAAG,EAAE,QAAQ,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAC7B,wBAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;aACzB,CAAC,CAAC;AACP,mBAAO,QAAQ,CAAC,OAAO,CAAC;SAC3B;KACJ,CAAA;CACJ,CAAA","file":"database.js","sourcesContent":["ï»¿var util = require(\"util\");\r\nvar mongo = require('mongoskin');\r\nvar q = require('q');\r\n\r\nmodule.exports = function(config){\r\n    //private\r\n    var db = {};\r\n    var patterns = {};\r\n    var configs = {};\r\n    var that = this;\r\n    //constructor\r\n    var init = function (cfg){\r\n        var url = util.format('mongodb://%s:%s@%s/%s', cfg.username, cfg.password, cfg.url, cfg.database);\r\n        that.db = mongo.db(url, { native_parser: true });\r\n        that.db.bind(cfg.patterns);\r\n        that.db.bind(cfg.configs);\r\n    }(config);\r\n\r\n    //public\r\n    return {\r\n        get_config:function(user){\r\n            var deferred = q.defer();\r\n            that.db.configs.findOne({user:user},function(err,doc){\r\n                    if(err) deferred.reject(err);\r\n                    deferred.resolve(doc);\r\n                });\r\n            return deferred.promise;\r\n        },\r\n        get_pattern:function(user){\r\n            var deferred = q.defer();\r\n            that.db.patterns.findOne({user:user},function(err,doc){\r\n                    if(err) deferred.reject(err);\r\n                    deferred.resolve(doc);\r\n                });\r\n            return deferred.promise;\r\n        }\r\n    }\r\n}"]}